---
title: About Network
date: 2020-02-14 11:11:00 -0700
categories: [network]
tags: 
Pin:
---

## TCP和UDP的区别

TCP（传输控制协议）和UDP（用户数据报协议）是互联网协议套件中的两种重要的传输层协议。它们各自在网络通信中扮演着不同的角色，主要区别如下：

1. **连接性**：
   - **TCP** 是一种面向连接的协议，意味着在数据传输之前，必须在两个通信终端之间建立一个连接。这个过程通常被称为“三次握手”。
   - **UDP** 是一种无连接的协议，数据可以在没有预先建立连接的情况下发送。

2. **可靠性**：
   - **TCP** 提供可靠的数据传输服务，确保数据包按序到达，并且没有丢失或错误。它通过序号、确认响应和重传机制来实现这一点。
   - **UDP** 不保证数据的可靠传输。数据包可能会丢失或乱序到达，且UDP不提供重传或确认机制。

3. **速度和效率**：
   - **TCP** 由于其可靠性机制（如错误检测和流量控制），通常比UDP慢，但提供了更加稳定的数据传输。
   - **UDP** 由于缺少复杂的控制机制，通常能提供更快的数据传输速度，尤其适用于对实时性要求高的应用，如视频会议和在线游戏。

4. **数据流控制**：
   - **TCP** 提供流量控制和拥塞控制机制，能够根据网络条件调整数据传输速率，避免网络拥塞。
   - **UDP** 不提供流量控制或拥塞控制，发送方的数据发送速率不会根据接收方或网络条件的变化而调整。

5. **用途**：
   - **TCP** 适用于要求高可靠性的应用，如网页浏览、电子邮件和文件传输。
   - **UDP** 适用于要求高速传输和实时性的应用，如视频流、在线游戏和语音通话。

简而言之，TCP和UDP各有优势和特点，它们的使用取决于应用程序的具体需求，包括对速度、可靠性和连接性的不同要求。



## TCP 为什么是可靠的

TCP（传输控制协议）被认为是可靠的，因为它提供了一系列机制来确保数据正确、完整且按顺序地从发送方传输到接收方。这些机制包括：

1. **序号和确认**：TCP为每个数据包分配一个序号，接收方通过发送确认（ACK）回复来确认已成功接收特定序列号的数据包。这确保了数据的按序到达和重传丢失的数据包。

2. **数据校验和**：每个TCP数据包都包括一个校验和，用于检测数据在传输过程中是否发生了错误。如果接收方检测到错误，那么该数据包会被丢弃，并期待重传，从而保证了数据的完整性。

3. **流量控制**：TCP使用窗口大小调整机制来控制发送方的数据传输速率，确保接收方有足够的缓冲区空间来接收新的数据。这防止了接收方被发送方发送的数据量所淹没。

4. **拥塞控制**：TCP实现了几种拥塞控制算法（如慢启动、拥塞避免、快速重传和快速恢复），用以监测和响应网络拥塞情况。这些控制措施调整数据的传输速率，以避免造成网络拥塞，从而提高整体网络的稳定性和效率。

5. **重传超时**：如果一个数据包在预定的时间内没有收到确认，TCP会自动重传该数据包，直到接收方确认接收或达到最大重传次数。

6. **有序数据传输和重组**：TCP保证了数据包按照发送顺序进行传输和接收。如果数据包乱序到达，TCP会在接收方重新排序，确保上层应用收到有序的数据流。

这些机制共同工作，确保了TCP的高可靠性，使其成为需要确保数据完整性和正确性的应用的理想选择，例如文件传输、网页浏览和电子邮件。

## TCP三次握手和四次挥手

TCP（传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。在TCP/IP模型中，TCP负责在两个应用程序之间建立一个可靠的通信连接。这个过程包括“三次握手”来建立连接和“四次挥手”来断开连接。

#### TCP三次握手（建立连接）

三次握手的主要目的是同步发送和接收双方的初始序列号，并交换TCP窗口大小信息，从而建立一个可靠的连接。其步骤如下：

1. **SYN：** 客户端发送一个TCP段，其中SYN标志位被设置（表明这是一个连接请求），并选择一个初始序列号X。此时客户端进入SYN-SENT状态。

2. **SYN-ACK：** 服务器接收到客户端的SYN请求后，回复一个TCP段，设置SYN标志位和ACK标志位（表明这是对客户端SYN的确认）。服务器同时选择自己的初始序列号Y，并将确认号设置为X+1。此时服务器进入SYN-RECEIVED状态。

3. **ACK：** 客户端收到服务器的SYN-ACK后，发送一个ACK段给服务器，确认号设置为Y+1。此时客户端进入ESTABLISHED状态，完成连接建立。服务器在收到这个ACK后也进入ESTABLISHED状态。

#### TCP四次挥手（断开连接）

四次挥手的主要目的是允许双方各自独立地关闭其发送数据的部分连接。这个过程确保了数据能够完整可靠地传输完毕。其步骤如下：

1. **FIN：** 当一个端点完成数据发送任务后，它将发送一个FIN段给对方，表明它已经没有数据发送了。

2. **ACK：** 对方收到FIN后，发送一个ACK段作为确认，并进入CLOSE-WAIT状态。发送方在发送FIN后进入FIN-WAIT-1状态。

3. **FIN：** 一段时间后，当对方也决定关闭连接时，它将发送自己的FIN段给原发送方，此时对方进入LAST-ACK状态。

4. **ACK：** 原发送方收到这个FIN后，发送一个ACK作为回应，并进入TIME-WAIT状态。经过一段时间（这段时间是为了确保对方收到了最后的ACK）后，连接彻底关闭。

整个四次挥手过程结束后，双方都能够确保数据的完整性和可靠性，从而安全地关闭TCP连接。


TCP四次挥手是断开一个TCP连接时使用的过程，它允许客户端和服务器双方各自独立地关闭其发送数据的部分连接。这个过程确保双方能够完成所有数据的传输和确认，从而安全地关闭连接。以下是四次挥手过程的解释，以服务器和客户端为例：

1. **客户端发送FIN给服务器**：
   - 当客户端完成数据发送任务后，它决定关闭到服务器的连接。此时，客户端发送一个FIN（finish）段给服务器，表明客户端没有数据发送了，希望开始关闭连接。发送FIN后，客户端进入FIN-WAIT-1状态，等待服务器的确认。
2. **服务器确认客户端的FIN，发送ACK给客户端**：
   - 服务器收到客户端的FIN段后，发送一个ACK（acknowledgment）段作为对FIN的确认回应。此时，服务器进入CLOSE-WAIT状态，而客户端在收到ACK后进入FIN-WAIT-2状态。服务器在发送ACK后，可能还有数据要发送给客户端，所以它不会立即发送自己的FIN段。
3. **服务器发送FIN给客户端**：
   - 服务器完成其数据发送任务后，再发送一个FIN段给客户端，通知客户端它也没有数据要发送了，并希望关闭连接。发送这个FIN后，服务器进入LAST-ACK状态，等待客户端的最后确认。
4. **客户端确认服务器的FIN，发送ACK给服务器**：
   - 客户端收到服务器的FIN段后，发送一个ACK段给服务器，作为对FIN的最终确认。发送这个ACK后，客户端进入TIME-WAIT状态。客户端在TIME-WAIT状态会等待足够长的时间（通常是两倍的最大段生命周期MSL），以确保服务器接收到了最后的ACK段。确认这一点后，客户端关闭连接。服务器在收到客户端的ACK后，也关闭连接。

四次挥手过程确保了即使在连接关闭的过程中，双方仍能完成数据的发送和确认。这个过程使得每一方都能够独立地关闭自己的发送部分，同时确认对方也准备好关闭连接，从而确保数据的完整性和连接的可靠性在整个会话结束时得到维护。

## 如果三次握手只做两次会怎样？

如果TCP三次握手只进行两次，那么TCP连接的建立过程将不会完全按照设计来执行，导致无法建立一个可靠的连接。具体影响和原因如下：

1. **连接的不可靠性：** 在标准的三次握手过程中，第三次握手是确认收到了对方的确认信号，确保双方都有发送和接收数据的能力。如果只进行两次握手，即仅发送SYN和SYN-ACK，没有最后的ACK确认，那么虽然服务器认为连接已经建立（在接收到客户端的SYN后发送SYN-ACK），但客户端没有发送最后的ACK来确认服务器的SYN-ACK。这种情况下，服务器端会认为连接已经建立，而客户端则可能因为没有发送最后的ACK而不认为连接已经建立。这会导致服务器误认为连接已经完全建立并准备接收数据，而客户端可能不会发送数据或响应，从而造成服务器资源的浪费。

2. **资源占用和安全风险：** 如果三次握手只做两次，服务器端会处于一种等待客户端最终确认（ACK）的状态，期间服务器为这个半开放的连接分配资源。这种情况下，如果有恶意用户故意发起大量的两次握手连接请求并不发送第三次的ACK，服务器会为这些半开放的连接分配资源，最终可能耗尽服务器的资源，导致拒绝服务（DoS）攻击。

3. **数据传输的不确定性：** 在只完成两次握手的情况下，由于缺少了客户端对服务器SYN-ACK的最终确认（ACK），双方对于连接状态的理解可能不一致，导致数据传输存在不确定性。客户端可能不会向服务器发送数据，因为它从未完成连接的建立过程，或者即使开始发送数据，由于连接建立过程不完整，数据的传输可靠性无法得到保证。

因此，三次握手是TCP设计中的一个关键机制，确保了连接的可靠性和数据传输的稳定性。缺少任何一次握手都会破坏这种可靠性，导致连接建立失败或者产生安全风险。

## HTTS 的工作过程

HTTS（Hyper Text Transfer Protocol Secure）是一种用于安全通信的网络协议，它在传统的HTTP（Hyper Text Transfer Protocol）的基础上加入了SSL/TLS（Secure Sockets Layer/Transport Layer Security）协议，以实现数据的加密传输和身份验证，保证数据传输的安全性。HTTS的工作过程主要包括以下几个步骤：

1. **客户端发起请求**：当用户在浏览器中输入一个HTTPS网址并访问时，客户端（如浏览器）会向服务器发起一个HTTPS连接请求。

2. **服务器响应并提供证书**：服务器接收到客户端的请求后，会向客户端发送其SSL证书。这个证书包含了服务器的公钥以及证书的签发机构等信息。

3. **验证证书**：客户端收到证书后会验证证书的合法性，包括证书的签发机构是否可信、证书是否过期、证书中的公钥是否与服务器匹配等。如果证书验证失败，浏览器会警告用户证书存在问题。

4. **客户端响应**：如果证书验证成功，客户端会生成一个随机的对称加密密钥，并使用服务器的公钥对这个密钥进行加密，然后将加密后的密钥发送给服务器。

5. **服务器解密并建立加密通道**：服务器接收到客户端发送的加密密钥后，会使用自己的私钥进行解密，获取对称加密密钥。此时，服务器和客户端都拥有了相同的对称加密密钥，双方就可以使用这个密钥来加密通信过程中的数据，建立起一个加密的通信通道。

6. **加密通信**：通过加密的通信通道，客户端和服务器可以安全地交换信息。所有通过这个通道传输的数据都会被加密，即使数据在传输过程中被拦截，没有密钥的第三方也无法解密这些数据。

7. **会话结束**：当通信结束时，双方可以选择结束会话，此时使用的对称加密密钥会被丢弃，保证了会话的一次性和安全性。

HTTPS通过这样的工作过程，确保了用户数据的隐私性和完整性，保护了数据不被第三方窃取或篡改，是现代网络安全的重要基石。

![https](https://raw.githubusercontent.com/wabol/pic/master/2024/02/upgit_20240217_1708233162.png)

## 重传机制和滑动窗口

重传机制和滑动窗口是计算机网络中确保数据传输可靠性的两种关键技术。

### 重传机制

重传机制是一种错误控制方法，用于处理数据传输过程中出现的错误。当发送方发送数据时，接收方会检查接收到的数据包是否完整无误。如果接收方发现数据包丢失或出现错误，它会请求发送方重传那些出错或丢失的数据包。这种机制确保了数据可以可靠地从发送方传输到接收方，即便在网络条件不稳定的环境下。

重传机制的实现通常包括超时和确认（ACK）机制。发送方在发送数据包后会启动一个计时器，如果在设定的超时时间内没有收到对应的确认信号，发送方就会重传该数据包。接收方在收到数据包后，如果数据包无误，就会发送一个确认信号给发送方。

### 滑动窗口

滑动窗口是一种流量控制机制，它限制了发送方在等待确认之前可以发送的数据包数量。窗口大小，即窗口中可以容纳的数据包数量，是动态调整的，这取决于网络的拥塞程度和接收方的处理能力。通过调整窗口大小，滑动窗口协议可以有效地管理数据传输的速率，防止网络拥塞，并确保接收方不会因为处理不过来而丢失数据。

滑动窗口分为发送窗口和接收窗口两种类型：
- **发送窗口**限制了发送方可以发送但还没有被确认的数据包的数量。
- **接收窗口**则限制了接收方能够接收的数据包的数量，以防止接收方的缓冲区溢出。

滑动窗口机制允许连续发送多个数据包，而不是每发送一个数据包就等待确认，从而提高了网络的利用率和传输效率。

重传机制和滑动窗口通常在传输层协议中实现，如TCP（传输控制协议）。TCP通过这些机制提供了一种可靠的数据传输服务，确保数据能按顺序、完整无误地从发送方传输到接收方。

## HTTP和HTTPS的区别？

HTTP（超文本传输协议）和HTTPS（安全超文本传输协议）都是互联网上用于数据通信的协议，它们在web浏览器与web服务器之间传输超文本数据。虽然两者在功能上相似，用于网页数据的传输，但它们在安全性方面有本质的区别。以下是HTTP和HTTPS之间的主要区别：

1. **加密**：
   - **HTTP**：不加密传输的数据，数据以明文形式传输，因此容易被截获或篡改。
   - **HTTPS**：通过SSL（安全套接字层）或TLS（传输层安全）协议对数据进行加密，保护数据传输过程中的隐私和完整性。这意味着即使数据被截获，也无法轻易解读内容。

2. **端口**：
   - **HTTP**：默认使用80端口进行通信。
   - **HTTPS**：默认使用443端口进行通信。

3. **性能**：
   - **HTTP**：由于不进行数据加密，所以通常速度比HTTPS快一点。
   - **HTTPS**：加密和解密过程需要消耗额外的处理资源和时间，可能会稍微降低速度，但随着技术进步，这种差异越来越小。

4. **安全性**：
   - **HTTP**：不提供数据加密，也不验证网站的身份，更容易遭受中间人攻击。
   - **HTTPS**：提供了数据加密、数据完整性验证和端点身份验证，显著增强了安全性。HTTPS需要网站拥有一个由权威证书颁发机构（CA）签发的有效SSL/TLS证书。

5. **用途**：
   - **HTTP**：适用于不涉及敏感信息的网站浏览，如阅读新闻或搜索信息。
   - **HTTPS**：适用于需要处理敏感信息的场景，如在线交易、银行业务和个人信息传输，现在互联网上的大多数网站都倾向于使用HTTPS。

6. **SEO（搜索引擎优化）**：
   - **HTTPS**：被搜索引擎（如Google）视为排名信号之一。采用HTTPS可以轻微提高网站的搜索排名。

总的来说，HTTPS在保障网站安全和用户隐私方面提供了显著的改进，是现代互联网中推荐的协议。随着数字化时代的发展，从HTTP迁移到HTTPS已成为网站管理员的一项重要任务。

## osi的七层表示

确实，当从底层向上层描述OSI模型时，第一层是物理层，第二层是数据链路层，这样描述是从更接近硬件的层次开始，逐步向更接近用户的高层次进展。我的先前描述是从应用层（用户最接近的层）开始向下到物理层（最接近硬件的层）的顺序，这是从用户角度向下看的视角。让我根据从物理层到应用层的顺序重新概述OSI模型：

1. **物理层（Physical Layer）**：
   - 负责实际的物理连接，包括电缆、光纤、无线传输的物理媒介。
   - 传输原始比特流，不关心具体内容。

2. **数据链路层（Data Link Layer）**：
   - 在物理层之上提供可靠的数据传输。
   - 负责帧的封装、物理地址寻址、错误检测和纠正。

3. **网络层（Network Layer）**：
   - 负责数据包的路由选择和逻辑寻址（如IP地址）。
   - 决定数据的路径以及数据包的转发。

4. **传输层（Transport Layer）**：
   - 提供端到端的通信服务。
   - 管理数据的分段、传输、错误检查和流控制。

5. **会话层（Session Layer）**：
   - 管理应用程序之间的会话和连接。
   - 负责建立、维护和终止通信会话。

6. **表示层（Presentation Layer）**：
   - 负责数据的表示、安全（加密）和压缩。
   - 确保数据在网络上的传输和接收方之间能正确解释。

7. **应用层（Application Layer）**：
   - 为应用程序提供网络服务。
   - 直接为用户提供接口和服务，如Web浏览、电子邮件和文件传输。

按照这个顺序，物理层是第一层，直接与硬件相连，应用层是第七层，最接近用户。这种从下到上的描述方式更符合数据传输的实际流程，从物理硬件到最终的用户应用。

## 什么是IP地址和MAC地址？它们如何工作？

IP地址和MAC地址都是网络中用于标识设备的地址，但它们在网络通信中扮演着不同的角色，并且工作在OSI模型的不同层次上。

#### IP地址
- **定义**：IP地址（Internet Protocol Address）是网络中每个设备用于识别其他设备的数字标签。在TCP/IP协议中，IP地址用于网络层来定位网络上的设备，并实现不同网络之间的数据传输。
- **工作原理**：IP地址提供了一个逻辑地址，用于在互联网上唯一标识一个网络接口。当数据包从一个设备发送到另一个设备时，数据包在网络层使用IP地址来确定如何从源头到达目的地。IP地址可以是静态的（手动分配并固定不变）或动态的（通过DHCP动态分配）。
- **版本**：目前有两种IP地址版本——IPv4和IPv6。IPv4地址由32位组成，通常表示为四个十进制数，每个数0-255，由点分隔（例如192.168.1.1）。IPv6地址由128位组成，用于解决IPv4地址耗尽的问题，表示为八组四个十六进制数（例如2001:0db8:85a3:0000:0000:8a2e:0370:7334）。

#### MAC地址
- **定义**：MAC地址（Media Access Control Address）是网络接口卡（NIC）的物理地址，嵌入到网络设备的硬件中。它是数据链路层的地址，用于局域网（LAN）中设备的物理寻址。
- **工作原理**：每个网络接口卡（如以太网卡）出厂时都被分配一个全球唯一的MAC地址。在同一局域网内，当一个设备需要向另一个设备发送信息时，它使用MAC地址来确保数据在物理网络上正确地达到目标设备。例如，在以太网中，数据包（帧）包含源MAC地址和目标MAC地址，确保帧的正确传递。
- **格式**：MAC地址通常由六个字节（48位）组成，表示为十六进制数，由冒号（:）或短划线（-）分隔（例如00:1A:2B:3C:4D:5E）。

#### 它们如何一起工作
在一个典型的网络通信场景中，IP地址用于在网络层处理设备间的通信，确定数据包的源头和目的地。当数据包到达目的地网络后，数据链路层使用MAC地址来确保数据包能够在局域网内准确地传输到具体的物理设备。

简而言之，IP地址允许数据包在全球范围内的网络中被路由，而MAC地址则用于在本地网络内部的具体传输。

## 如何使用Linux命令监控网络状态？

在Linux中，有多个命令行工具可用于监控网络状态，帮助你诊断网络连接问题、监控数据传输等。以下是一些常用的命令及其基本用法：

#### 1. `ping`
- 用于测试从本机到目标主机的网络连接。
- 基本用法：`ping [选项] 目的地`
- 示例：`ping google.com`

#### 2. `ifconfig` 或 `ip addr show`
- 显示网络接口的当前配置信息，如IP地址、子网掩码和状态。
- `ifconfig`（传统命令，某些系统上可能需要安装net-tools包）
- `ip addr show`（较新的命令，推荐使用）
- 示例：`ifconfig` 或 `ip addr show`

#### 3. `netstat`
- 显示网络连接、路由表、接口统计、伪装连接和多播成员。
- 基本用法：`netstat [选项]`
- 示例：`netstat -tuln`（显示所有监听端口）

#### 4. `ss`
- 用于显示套接字统计。它是`netstat`的现代替代品，提供更多信息和更快的输出。
- 基本用法：`ss [选项]`
- 示例：`ss -tuln`（列出所有处于监听状态的TCP和UDP端口）

#### 5. `traceroute` 或 `tracepath`
- 用于显示数据包到达主机所经过的路由。
- `traceroute [目的地]`（可能需要安装）
- `tracepath [目的地]`（大多数现代Linux发行版中可用）
- 示例：`traceroute google.com`

#### 6. `tcpdump`
- 一个强大的命令行网络分析工具，用于捕获网络上的数据包。
- 基本用法：`tcpdump [选项]`
- 示例：`tcpdump -i eth0`（捕获接口eth0上的所有数据包）

#### 7. `nmap`
- 用于网络探测和安全审核。
- 基本用法：`nmap [选项] [目的地]`
- 示例：`nmap -v -A google.com`

#### 8. `iperf` / `iperf3`
- 测试网络带宽性能的工具。
- 需要在两台机器上安装：一台作为服务器运行，另一台作为客户端连接到服务器。
- 服务器端用法：`iperf3 -s`
- 客户端用法：`iperf3 -c [服务器IP地址]`

这些工具各有侧重点，从基本的连接测试到详细的网络性能分析，都是维护和监控Linux网络状态不可或缺的工具。根据你的具体需求，选择适合的命令来获取所需的网络信息。

## 什么是TCP拥塞控制？请描述其工作原理

TCP拥塞控制是传输控制协议（TCP）用来避免过度拥挤网络的一套机制。它的目标是确保网络中的每个链路不会被过度使用，从而避免数据包丢失和连接超时，提高网络通信的整体效率。TCP拥塞控制使用一系列算法来动态调整数据的发送速率，基于网络的当前状态来优化传输速度。以下是这些算法的工作原理：

#### 1. 慢启动（Slow Start）
- **目的**：连接开始时，确定网络的承载能力。
- **原理**：拥塞窗口（cwnd）从1个或几个段开始，每收到一个ACK，cwnd加倍。这导致传输速率指数增长，直到达到拥塞避免阈值（ssthresh）。

#### 2. 拥塞避免（Congestion Avoidance）
- **目的**：避免网络拥塞，实现稳定增长。
- **原理**：一旦cwnd达到ssthresh，进入拥塞避免阶段。此时，cwnd以线性方式增长，每经过一个往返时间（RTT）增加1个MSS（最大段大小）。

#### 3. 快速重传（Fast Retransmit）
- **目的**：快速恢复丢失的数据包。
- **原理**：当发送方收到三个重复的ACK时，它会立即重传未被确认的数据包，而不是等待重传计时器到期。

#### 4. 快速恢复（Fast Recovery）
- **目的**：在检测到丢包时快速恢复传输。
- **原理**：进入快速恢复阶段后，cwnd设置为ssthresh加上3个MSS的大小（对应于收到的三个重复ACK）。对每个进一步收到的重复ACK，cwnd增加1个MSS。当收到新的ACK时，将cwnd设置为ssthresh的大小，然后进入拥塞避免阶段。

#### 工作流程
1. **连接建立**：使用慢启动算法增加cwnd，快速增加发送速率。
2. **达到阈值**：当cwnd达到ssthresh时，切换到拥塞避免算法，增速转为线性，以避免引起拥塞。
3. **丢包检测**：如果检测到丢包（通过超时或接收到重复ACK），减小ssthresh并根据情况调整cwnd，使用快速重传和快速恢复算法快速恢复数据传输。

#### 整体目标
TCP拥塞控制的目标是在保证网络不被过度使用的同时，尽可能快速地传输数据。它通过动态调整发送速率来响应网络中的拥塞情况，以此来优化网络资源的使用，提高通信的可靠性和效率。
